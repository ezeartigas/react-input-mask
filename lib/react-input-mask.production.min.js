"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=require("react"),n=e(t),i=require("react-dom");require("prop-types");var r=e(require("invariant"));function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,function(e,t){for(var n=Object.getOwnPropertyNames(t),i=0;i<n.length;i++){var r=n[i],a=Object.getOwnPropertyDescriptor(t,r);a&&a.configurable&&void 0===e[r]&&Object.defineProperty(e,r,a)}}(e,t)}function l(e,t){if(null==e)return{};var n,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}require("warning");var u="undefined"!=typeof window?t.useLayoutEffect:t.useEffect;function s(e){return requestAnimationFrame(e)}function c(e){cancelAnimationFrame(e)}function f(e){var t=e.ownerDocument;return t.hasFocus()&&t.activeElement===e}function h(e){return null==e?void 0:e.ownerDocument}function g(e){var t=function(e){var t;return null==(t=h(e))?void 0:t.defaultView}(e);return!!t&&e instanceof t.HTMLElement}function v(e){return t.useCallback((function(){var t=e.current,n="undefined"!=typeof window&&g(t);if(!t||!n)return null;if("INPUT"!==t.nodeName&&(t=t.querySelector("input")),!t)throw new Error("react-input-mask: inputComponent doesn't contain input node");return t}),[e])}function d(e,n){var i,r,a,o,l=t.useRef({start:null,end:null}),h=v(e),g=t.useCallback((function(){return function(e){var t=e.selectionStart,n=e.selectionEnd;return{start:t,end:n,length:n-t}}(h())}),[h]),d=t.useCallback((function(){return l.current}),[]),p=t.useCallback((function(e){var t=h();t&&f(t)&&(!function(e,t,n){void 0===n&&(n=t),e.setSelectionRange(t,n)}(t,e.start,e.end),l.current=g())}),[h,g]),m=t.useCallback((function(){l.current=g()}),[g]),P=(i=m,r=t.useRef(null),a=t.useCallback((function(){null===r.current&&function e(){i(),r.current=s(e)}()}),[i]),o=t.useCallback((function(){c(r.current),r.current=null}),[]),t.useEffect((function(){r.current&&(o(),a())}),[a,o]),t.useEffect(c,[]),[a,o]),k=P[0],b=P[1];return u((function(){if(n){var e=h();return e.addEventListener("focus",k),e.addEventListener("blur",b),f(e)&&k(),function(){e.removeEventListener("focus",k),e.removeEventListener("blur",b),b()}}})),{getSelection:g,getLastSelection:d,setSelection:p}}function p(e,n){var i=t.useRef(),r=d(i,n),a=r.getSelection,o=r.getLastSelection,l=r.setSelection,u=function(e,n){var i=v(e),r=t.useRef(n);return{getValue:t.useCallback((function(){return i().value}),[i]),getLastValue:t.useCallback((function(){return r.current}),[]),setValue:t.useCallback((function(e){r.current=e;var t=i();t&&(t.value=e)}),[i])}}(i,e),s=u.getValue,c=u.getLastValue,f=u.setValue;return{inputRef:i,getInputState:function(){return{value:s(),selection:a()}},getLastInputState:function(){return{value:c(),selection:o()}},setInputState:function(e){var t=e.value,n=e.selection;f(t),l(n)}}}var m=["disabled","onBlur","onChange","onFocus","onMouseDown","readOnly","value"],P={9:/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};var k=function(e){var t=this;this.isCharacterAllowedAtPosition=function(e,n){var i=t.maskOptions.maskPlaceholder;return!!t.isCharacterFillingPosition(e,n)||!!i&&i[n]===e},this.isCharacterFillingPosition=function(e,n){var i=t.maskOptions.mask;if(!e||n>=i.length)return!1;if(!t.isPositionEditable(n))return i[n]===e;var r=i[n];return new RegExp(r).test(e)},this.isPositionEditable=function(e){var n=t.maskOptions,i=n.mask,r=n.permanents;return e<i.length&&-1===r.indexOf(e)},this.isValueEmpty=function(e){return e.split("").every((function(e,n){return!t.isPositionEditable(n)||!t.isCharacterFillingPosition(e,n)}))},this.isValueFilled=function(e){return t.getFilledLength(e)===t.maskOptions.lastEditablePosition+1},this.getDefaultSelectionForValue=function(e){var n=t.getFilledLength(e),i=t.getRightEditablePosition(n);return{start:i,end:i}},this.getFilledLength=function(e){return function(e,t){for(var n=e.length-1;n>=0;n--){if(t(e[n],n))return n}return-1}(e.split(""),(function(e,n){return t.isPositionEditable(n)&&t.isCharacterFillingPosition(e,n)}))+1},this.getStringFillingLengthAtPosition=function(e,n){return e.split("").reduce((function(e,n){return t.insertCharacterAtPosition(e,n,e.length)}),function(e,t){void 0===t&&(t=1);for(var n="",i=0;i<t;i++)n+=e;return n}(" ",n)).length-n},this.getLeftEditablePosition=function(e){for(var n=e;n>=0;n--)if(t.isPositionEditable(n))return n;return null},this.getRightEditablePosition=function(e){for(var n=t.maskOptions.mask,i=e;i<n.length;i++)if(t.isPositionEditable(i))return i;return null},this.formatValue=function(e){var n=t.maskOptions,i=n.maskPlaceholder,r=n.mask;if(!i){for(e=t.insertStringAtPosition("",e,0);e.length<r.length&&!t.isPositionEditable(e.length);)e+=r[e.length];return e}return t.insertStringAtPosition(i,e,0)},this.clearRange=function(e,n,i){if(!i)return e;var r=n+i,a=t.maskOptions,o=a.maskPlaceholder,l=a.mask,u=e.split("").map((function(e,i){var a=t.isPositionEditable(i);return!o&&i>=r&&!a?"":i<n||i>=r?e:a?o?o[i]:"":l[i]})).join("");return t.formatValue(u)},this.insertCharacterAtPosition=function(e,n,i){var r=t.maskOptions,a=r.mask,o=r.maskPlaceholder;if(i>=a.length)return e;var l=t.isCharacterAllowedAtPosition(n,i),u=t.isPositionEditable(i),s=t.getRightEditablePosition(i),c=o&&s?n===o[s]:null,f=e.slice(0,i);!l&&u||(e=f+(l?n:a[i]));return l||u||c||(e=t.insertCharacterAtPosition(e,n,i+1)),e},this.insertStringAtPosition=function(e,n,i){var r=t.maskOptions,a=r.mask,o=r.maskPlaceholder;if(!n||i>=a.length)return e;var l=n.split(""),u=t.isValueFilled(e)||!!o,s=e.slice(i);if(e=l.reduce((function(e,n){return t.insertCharacterAtPosition(e,n,e.length)}),e.slice(0,i)),u)e+=s.slice(e.length-i);else if(t.isValueFilled(e))e+=a.slice(e.length).join("");else{e=s.split("").filter((function(e,n){return t.isPositionEditable(i+n)})).reduce((function(e,n){var i=t.getRightEditablePosition(e.length);return null===i?e:(t.isPositionEditable(e.length)||(e+=a.slice(e.length,i).join("")),t.insertCharacterAtPosition(e,n,e.length))}),e)}return e},this.processChange=function(e,n){var i=t.maskOptions,r=i.mask,a=i.prefix,o=i.lastEditablePosition,l=e.value,u=e.selection,s=n.value,c=n.selection,f=l,h="",g=0,v=0,d=Math.min(c.start,u.start);if(u.end>c.start?(h=f.slice(c.start,u.end),v=(g=t.getStringFillingLengthAtPosition(h,d))?c.length:0):f.length<s.length&&(v=s.length-f.length),f=s,v){if(1===v&&!c.length)d=c.start===u.start?t.getRightEditablePosition(u.start):t.getLeftEditablePosition(u.start);f=t.clearRange(f,d,v)}return f=t.insertStringAtPosition(f,h,d),(d+=g)>=r.length?d=r.length:d<a.length&&!g?d=a.length:d>=a.length&&d<o&&g&&(d=t.getRightEditablePosition(d)),{value:f=t.formatValue(f),enteredString:h,selection:{start:d,end:d}}},this.maskOptions=function(e){var t=e.mask,n=e.maskPlaceholder,i=[];if(!t)return{maskPlaceholder:null,mask:null,prefix:null,lastEditablePosition:null,permanents:[]};if("string"==typeof t){var r=!1,a="";t.split("").forEach((function(e){r||"\\"!==e?(!r&&P[e]||i.push(a.length),a+=e,r=!1):r=!0})),t=a.split("").map((function(e,t){return-1===i.indexOf(t)?P[e]:e}))}else t.forEach((function(e,t){"string"==typeof e&&i.push(t)}));n&&(n=1===n.length?t.map((function(e,t){return-1!==i.indexOf(t)?e:n})):n.split(""),i.forEach((function(e){n[e]=t[e]})),n=n.join(""));for(var o=i.filter((function(e,t){return e===t})).map((function(e){return t[e]})).join(""),l=t.length-1;-1!==i.indexOf(l);)l--;return{maskPlaceholder:n,prefix:o,mask:t,lastEditablePosition:l,permanents:i}}(e)},b=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.render=function(){var e=this.props,t=e.children,i=l(e,["children"]);return n.cloneElement(t,i)},t}(n.Component),E=t.forwardRef((function(e,o){var u=e.alwaysShowMask,c=e.children,g=e.mask,d=e.maskPlaceholder,P=e.beforeMaskedStateChange,E=l(e,["alwaysShowMask","children","mask","maskPlaceholder","beforeMaskedStateChange"]);!function(e){var t=e.mask,n=e.maskPlaceholder;t&&n&&1!==n.length&&n.length!==t.length&&r(!1)}(e);var S,C,y=new k({mask:g,maskPlaceholder:d}),w=!!g,O=!E.disabled&&!E.readOnly,V=null!==e.value&&void 0!==e.value,F=(S=w,C=t.useRef(),t.useEffect((function(){C.current=S})),C.current),L=p(function(e){return""+e}((V?e.value:e.defaultValue)||""),w),A=L.inputRef,R=L.getInputState,M=L.setInputState,x=L.getLastInputState,D=v(A);if(w&&V){var j=D(),I=j&&f(j)||u||e.value?y.formatValue(e.value):e.value;P&&(I=P({nextState:{value:I,selection:{start:null,end:null}}}).value),M(a({},x(),{value:I}))}var q=x(),N=q.selection,B=q.value;t.useEffect((function(){if(w){var e=f(D()),t=N,n=R(),i=a({},n);if(!V){var r=n.value,o=y.formatValue(r),l=y.isValueEmpty(o);!l||e||u?i.value=o:l&&!e&&(i.value="")}e&&!F?i.selection=y.getDefaultSelectionForValue(i.value):V&&e&&t&&null!==t.start&&null!==t.end&&(i.selection=t),P&&(i=P({currentState:n,nextState:i})),M(i)}}));var T=a({},E,{onFocus:function(t){A.current=t.target;var n=R().value;if(w&&!y.isValueFilled(n)){var i=y.formatValue(n),r=y.getDefaultSelectionForValue(i),a={value:i,selection:r};P&&(i=(a=P({currentState:R(),nextState:a})).value,r=a.selection),M(a),i!==n&&e.onChange&&e.onChange(t),s((function(){M(x())}))}e.onFocus&&e.onFocus(t)},onBlur:function(t){var n=R().value,i=x().value;if(w&&!u&&y.isValueEmpty(i)){var r="",a={value:r,selection:{start:null,end:null}};P&&(r=(a=P({currentState:R(),nextState:a})).value),M(a),r!==n&&e.onChange&&e.onChange(t)}e.onBlur&&e.onBlur(t)},onChange:w&&O?function(t){var n=R(),i=x(),r=y.processChange(n,i);P&&(r=P({currentState:n,previousState:i,nextState:r})),M(r),e.onChange&&e.onChange(t)}:e.onChange,onMouseDown:w&&O?function(t){var n=D(),i=R().value,r=h(n);if(!f(n)&&!y.isValueFilled(i)){var o=t.clientX,l=t.clientY,u=(new Date).getTime();r.addEventListener("mouseup",(function e(t){if(r.removeEventListener("mouseup",e),f(n)){var i=Math.abs(t.clientX-o),s=Math.abs(t.clientY-l),c=Math.max(i,s),h=(new Date).getTime()-u;if(c<=10&&h<=200||c<=5&&h<=300){var g=x(),v=a({},g,{selection:y.getDefaultSelectionForValue(g.value)});M(v)}}}))}e.onMouseDown&&e.onMouseDown(t)}:e.onMouseDown,ref:function(e){A.current=i.findDOMNode(e),!function(e){return"function"==typeof e}(o)?null!==o&&"object"==typeof o&&(o.current=e):o(e)},value:w&&V?B:e.value});return c?(function(e,t){m.filter((function(n){return null!=t.props[n]&&t.props[n]!==e[n]})).length&&r(!1)}(e,c),n.createElement(b,T,c)):n.createElement("input",T)}));E.displayName="InputMask",E.defaultProps={alwaysShowMask:!1,maskPlaceholder:"_"},module.exports=E;
